\documentclass[a4paper, 12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}
\usepackage{amsfonts}
\usepackage{amsmath} 
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{indentfirst} 

\usepackage{geometry} % Меняем поля страницы
\geometry{left=2cm}% левое поле
\geometry{right=1.5cm}% правое поле
\geometry{top=1.5cm}% верхнее поле
\geometry{bottom=3cm}% нижнее поле

\newtheorem{theorem}{Теорема}

\begin{document}
	% Титульный лист
	\begin{titlepage}
		\begin{center}
			Санкт-Петербургский политехнический университет Петра Великого \\ Физико-механический институт \\ Высшая школа прикладной математики и вычислительной физики
		\end{center}
		\vspace{10em}
		\begin{center}
			\Large Отчет по лабораторной работе №5 \\ по дисциплине "Численные методы"
		\end{center}
		\vspace{1em}
		\begin{center}
			\Huge Решение задачи Коши для ОДУ 1 порядка. Модифицированный метод Эйлера.
		\end{center}
		\vspace{15em}
		{\Large 
			
			Выполнил: студент гр. 5030102/00003 Красников Р.А.
			\vspace{1em}
			
			Преподаватель: Добрецова С.Б.}
		\vspace{\fill}
		\begin{center}
			Санкт-Петербург \\ 2022
		\end{center}
	\end{titlepage}
	\newpage
	
	\section{Формулировка и формализация задачи.}
	
	\subsection{Формулировка задачи.}
	
	Решить задачу Коши для ОДУ 1 порядка, разрешенного относительно производной.
	
	Построить графики точного и полученного решения, а также график ошибки для двух значений шага.
	
	Построить графики и исследовать зависимости фактической точности и числа итераций от заданной точности.
	
	Внести в начальное условие возмущение. Построить график зависимости фактической ошибки от величины возмущения при фиксированной точности.  
	
	Построить график зависимости фактической точности от величины шага. По графику определить порядок точности метода и константу
	
	\subsection{Постановка задачи.}
	
	Дана задача Коши
	\begin{equation} \label{cauchytask}
		\begin{gathered}
			y'=f(x,y), x\in[a,b],\\
			y(a)=y_0
		\end{gathered}
	\end{equation}
	Ее решение -- непрерывно дифференцируемая функция $\varphi$ такая, что
	\begin{equation}
		\begin{gathered}
			\forall x\in[a,b]: \varphi'(x)=f(x,\varphi(x)),\\ 
			\varphi(a)=y_0
		\end{gathered}
	\end{equation}
	Также задана сетка $\{x_i\}_{i=0}^n$.
	
	Найти сеточную функцию $\{(x_i,y_i)\}_{i=0}^n$ такую, что
	\begin{equation}
		y_i\approx\varphi(x_i), i=\overline{0,n}
	\end{equation}

	\section{Алгоритм и условия его применимости.}
	
	\subsection{Алгоритм решения задачи Коши \eqref{cauchytask} модифицированным методом Эйлера.}
	\label{alghorithm_simple}
	
	\begin{enumerate}
		\item Ввести функцию $f(x,y)$, начальное условие $y_0$, отрезок $[a,b]$, число отрезков разбиения $m$ (число точек равномерной сетки составит $m+1$).
		\item Для всех $i=\overline{1,m}$ вычислить
		\begin{equation} \label{method}
			y_i = y_{i-1} + hf(x_{i-1} + \frac{h}{2}, y_{i-1}+\frac{h}{2}f(x_{i-1},y_{i-1}))
		\end{equation}
		где $h=\dfrac{b-a}{m}$, $x_i=a+ih$.
		\item $\{(x_i,y_i)\}_{i=0}^m$ -- искомая сеточная функция
	\end{enumerate}
	
	\textit{Замечание.} Можно задавать не число отрезков разбиения (или число точек равномерной сетки), а непосредственно сам шаг $h$, но в этом случае не гарантируется, что полученная сеточная функция будет определена в точке $b$, то есть формально решение будет найдено для некоторого меньшего отрезка ${[a,x_m] \varsubsetneq [a,b]}$.
	
	\subsection{Алгоритм решения задачи Коши \eqref{cauchytask} модифицированным методом Эйлера с апостериорной оценкой погрешности.} \label{alghorithm_runge}
	
	\begin{enumerate}
		\item Ввести функцию $f(x,y)$, начальное условие $y_0$, отрезок $[a,b]$, число отрезков разбиения $m$ (число точек равномерной сетки составит $m+1$), точность $\epsilon$.
		\item Для всех $i=\overline{1,m}$
		\begin{enumerate}
			\item Положить $n=1$ -- число отрезков разбиения на отрезке $[x_{i-1},x_i]$.
			\item Применить алгоритм \ref{alghorithm_simple}, передав ему на вход функцию $f(x,y)$, начальное условие $y_{i-1}$, отрезок $[x_{i-1}, x_{i}]$, число отрезков разбиения $n$ -- получаем сеточную функцию $\{(\widetilde{x}_j,\widetilde{y}_j)\}_{j=0}^n$.
			\item Положить $y_i^{(n)}=\widetilde{y}_n$.
			\item Применить алгоритм \ref{alghorithm_simple}, передав ему на вход функцию $f(x,y)$, начальное условие $y_{i-1}$, отрезок $[x_{i-1}, x_{i}]$, число отрезков разбиения $2n$ -- получаем сеточную функцию $\{(\widetilde{\widetilde{x}}_j,\widetilde{\widetilde{y}}_j)\}_{j=0}^{2n}$. \label{cycle_step}
			\item Положить $y_i^{(2n)}=\widetilde{\widetilde{y}}_{2n}$.
			\item Если
			\begin{equation}
				|y_i^{(2n)}-y_i^{(n)}| < 3\epsilon,
			\end{equation}
			то положить $y_i=y_i^{(2n)}$ и продолжить вычисления для $i=i+1$ (если $i<m$), иначе положить $n=2n$ и вернуться к шагу \ref{cycle_step}.
		\end{enumerate}
		\item $\{(x_i,y_i)\}_{i=0}^m$ -- искомая сеточная функция, притом такая, что
		\begin{equation}
			|y_1-\varphi(x_1)|<\epsilon,
		\end{equation}
		где $\varphi(x)$ -- точное решение.
	\end{enumerate}

	\textit{Замечание.} При кодировании алгоритма 2.2 учтено, что при применении алгоритма 2.1 (п. 2b, 2d) вовсе не обязательно запоминать получаемую сеточную функцию -- достаточно лишь получить последнее значение сеточной функции, применяя рекуррентную формулу \eqref{method}. 

	\subsection{Условия применимости алгоритмов \ref{alghorithm_simple}, \ref{alghorithm_runge} решения задачи Коши \eqref{cauchytask} модифицированным методом Эйлера.}
	
	\begin{enumerate}
		\item Задача Коши \eqref{cauchytask} имеет единственное решение $y=\varphi(x), x\in[a,b]$.
	\end{enumerate}

	Условие применимости в таком виде не удобно в применении на практике. Поэтому можно использовать следующие теоремы:
	\begin{theorem}[О единственности решения задачи Коши] \label{lipschizoncauchyunique} ~\\
		Пусть $\Pi=[a,b]\times[c,d]$, функция $f(x,y) : \Pi \rightarrow \mathbb{R}$ непрерывна в $\Pi$ и удовлетворяет в $\Pi$ условию Липшица по $y$, то есть
		\begin{equation}
			\forall (x,y_1),(x,y_2)\in\Pi : \exists L>0 : |f(x,y_1)-f(x,y_2)|<L|y_1-y_2|,
		\end{equation}
		Если $\varphi_1(x),\varphi_2(x)$ -- решения задачи Коши \eqref{cauchytask}, то $\forall x\in[a,b]:\varphi_1(x)=\varphi_2(x)$.
	\end{theorem}

	\begin{theorem} \label{lipschiz} ~\\
		Если функции $f(x,y)$, $\dfrac{\partial f}{\partial y}(x,y)$ определены и непрерывны в $\Pi=[a,b]\times[c,d]$, то $f(x,y)$ удовлетворяет в $\Pi$ условию Липшица по $y$.
	\end{theorem}
	
	Мы не можем утверждать заранее, какой окажется область значений $[c,d]$ решения задачи Коши $\varphi(x)$. Поэтому в качестве достаточного условия применимости метода можно использовать следующее условие:
	\begin{equation*}
		\forall [c,d]\subset\mathbb{R}, f(x,y),\dfrac{\partial f}{\partial y}(x,y) \text{ определены на } \Pi=[a,b]\times[c,d] : f(x,y), \dfrac{\partial f}{\partial y}(x,y) \text{ непрерывны в } \Pi 
	\end{equation*}
	
	\section{Анализ задачи.}

	Для выполнения работы мне была предложена задача Коши
	\begin{equation} \label{mytaskbad}
		\begin{gathered}
			xy'-2x^2\sqrt{y}=4y, x\in[1,2],\\
			y(1)=0
		\end{gathered}
	\end{equation}
	и ее точное решение $y=x^4\ln^2x$. Однако нетрудно видеть, что $y=0$ также является решением задачи Коши \eqref{mytaskbad} и $\exists x\in[1,2]: x^4\ln^2x\neq0$, то есть решение задачи Коши \eqref{mytaskbad} не единственно.
	
	Поэтому исследование выполнено для задачи Коши
	\begin{equation} \label{mytaskinit}
		\begin{gathered}
			xy'-2x^2\sqrt{y}=4y, x\in[1,2],\\
			y(1)=1
		\end{gathered}
	\end{equation}
	и ее точного решения $y^*=x^4(\ln x+1)^2$. 
	
	\subsection{Проверка существования и единственности решения.}
	\label{solexistance}
	
	Приведем задачу Коши \eqref{mytaskinit} к виду \eqref{cauchytask}
	\begin{equation} \label{mytask}
		\begin{gathered}
			y'=2x\sqrt{y}+4\frac{y}{x}, x\in[1,2],\\
			y(1)=1
		\end{gathered}
	\end{equation}
	Ее точное решение $y^*=x^4(\ln x+1)^2$. Область значений решения -- $[1, 16(\ln2+1)^2]$ В задаче Коши \eqref{mytask} можно считать $f(x,y):[1,2]\times[1, 16(\ln2+1)^2] \rightarrow \mathbb{R}$, поскольку рассмотрения именно такого сужения функции $f(x,y)$ достаточно для исследуемой задачи -- ее решение для суженной функции $f(x,y)$ по прежнему $y^*=x^4(\ln x+1)^2$, а единственность будет показана далее.
	
	Для задачи Коши \eqref{mytask} имеем
	\begin{equation*}
		\begin{gathered}
			f(x,y) = 2x\sqrt{y}+4\frac{y}{x},\\
			\frac{\partial f}{\partial y}(x,y) = \frac{x}{\sqrt{y}} + \frac{4}{x}
		\end{gathered}
	\end{equation*}

	Эти функции непрерывны в любом прямоугольнике $[1,2]\times[1,d], d\geq1$, поэтому если $\varphi(x)$ -- решение задачи Коши \eqref{mytask}, то $\varphi(x)=x^4(\ln x+1)^2$.
	
	\section{Проверка условий применимости модифицированного метода Эйлера.}
	
	\begin{enumerate}
		\item Решение задачи Коши \eqref{mytask} единственно. (см. пункт \ref{solexistance}).
	\end{enumerate}

	Условия применимости модифицированного метода Эйлера выполнены.
	
	\section{Тестовый пример.} \label{testexample}
	
	Для демонстрации модифицированного метода Эйлера вычислим приближенное значение решения задачи Коши \eqref{mytask} в точке $1,2$ для шагов $0.2$ и $0.1$.
	
	\begin{enumerate}
		\item Шаг $h=0.2$:
			\begin{equation*}
				\begin{aligned}
					x_0&=a=1,\\
					y_0&=y(a)=y(1)=1,\\
					x_1^{(h)}&=x_0+h=1.2,\\
					y_1^{(h)}&=y_0+hf(x_0+\frac{h}{2},y_0+\frac{h}{2}f(x_0,y_0))=\\&=1+0.2f(1+\frac{0.2}{2},1+\frac{0.2}{2}f(1,1))=2.7202
				\end{aligned}
			\end{equation*}	
		\item Шаг $h=0.1$
			\begin{equation*}
				\begin{aligned}
					x_0&=a=1,\\
					y_0&=y(a)=y(1)=1,\\
					x_1^{(\frac{h}{2})}&=x_0+h=1.1,\\
					y_1^{(\frac{h}{2})}&=y_0+hf(x_0+\frac{h}{2},y_0+\frac{h}{2}f(x_0,y_0))=\\&=1+0.1f(1+\frac{0.1}{2},1+\frac{0.1}{2}f(1,1))=1.7347,\\
					x_2^{(\frac{h}{2})}&=x_0+2h=1.2,\\
					y_2^{(\frac{h}{2})}&=y_1^{(\frac{h}{2})}+hf(x_1^{(\frac{h}{2})}+\frac{h}{2},y_1^{(\frac{h}{2})}+\frac{h}{2}f(x_1^{(\frac{h}{2})},y_1^{(\frac{h}{2})}))=\\&=1.7347+0.1f(1.1+\frac{0.1}{2},1.7347+\frac{0.1}{2}f(1.1,1.7347))=2.8389
				\end{aligned}
			\end{equation*}
	\end{enumerate} 

	Оценка погрешности по правилу Рунге:
	\begin{equation*}
		|y_2^{(\frac{h}{2})}-y^*(x_2^{(\frac{h}{2})})|\approx\frac{|y_2^{(\frac{h}{2})}-y_1^{(h)}|}{3}=0.0396
	\end{equation*}
	
	Фактическое значение погрешности:
	\begin{equation*}
		|y_2^{(\frac{h}{2})}-y^*(x_2^{(\frac{h}{2})})|=0.0598
	\end{equation*}

	Погрешность по правилу Рунге оказалась немного меньше, чем фактическая -- это можно объяснить тем, что правило Рунге справделиво в точности при $h\rightarrow0$, а в этом примере $h$ еще достаточно велико. Притом стоит отметить, что по порядку величины значения совпали.
	
	\section{Подготовка контрольных тестов.}
	
	Для построения графиков полученных решений и ошибок были выбраны значения шага $h_1=0.2$ и $h_2=0.1$
	
	Для построения графиков зависимостей фактической ошибки и числа итераций (число разбиений отрезка) от заданной точности были выбраны значения точности $\epsilon_i=10^{-i}, i=\overline{1,11}$, шаг $h=0.1$. 
	
	Для построения графика зависимости фактической ошибки от возмущения начального условия $\Delta y$ были выбраны значения $\Delta y_i=0.01i, i=\overline{0,100}$, шаг $h=0.1$, точность $\epsilon=10^{-5}$.
	
	Для построения графика зависимости фактической точности от величины шага были выбраны значения шага $h_i=2^{-i}, i=\overline{0,14}$
	
	\section{Модульная структура программы.}
	Для проведения исследования была написана программа на языке C++, состоящая из следующих функций:
	\begin{itemize}
		\item SimpleModEulerODE(вх.: функция $f(x,y)$, нач. условие $y_0$, отрезок $[a,b]$, число отрезков разбиения $n$; вых.: сеточная функция $\{(x_i,y_i)\}_{i=0}^n$) -- вычисляет численное решение задачи Коши $y'=f(x,y),x\in[a,b]$ с начальным условием $y(a)=y_0$ по алгоритму \ref{alghorithm_simple}.
		\item SimpleModEulerODELastY(вх.: функция $f(x,y)$, нач. условие $y_0$, отрезок $[a,b]$, число отрезков разбиения $n$; вых.: число $y_n$) -- аналогична функции SimpleModEulerODE, но возвращает значение сеточной функции в точке $x_n=b$, не запоминая промежуточные $y_i$; использована в алгоритме \ref{alghorithm_runge}. (т.е в функции ModEulerODERungesAcc, см. далее)
		\item ModEulerODERungesAcc(вх.: вх.: функция $f(x,y)$, нач. условие $y_0$, отрезок $[a,b]$, число отрезков разбиения $n$, точность $\epsilon$; вых.: сеточная функция $\{(x_i,y_i)\}_{i=0}^n$, макс. число итераций $n$) -- вычисляет численное решение задачи Коши $y'=f(x,y),x\in[a,b]$ с начальным условием $y(a)=y_0$ по алгоритму \ref{alghorithm_runge} с точностью $\epsilon$, дополнительно для проведения исследования возвращает максимальное число итераций $n$.
	\end{itemize}

	\section{Анализ результатов.}
	
	\subsection{Анализ графиков полученного решения.}
	
	На графике полученного и точного решений видим, что функция $y^*$ являющаяся точным решением возрастает на $[1,2]$ и выпукла на $[1,2]$. Точки сеточной функции представляют похожую зависимость, но с ростом $x$ начинают отдаляться от точного решения в меньшую сторону, как бы не успевая за ростом функции $y^*$. Решение, полученное для шага $h_2=0.1$ ближе к точному, чем полученное для шага $h_1=0.2$.
	
	На графике ошибок полученных решений видим, что с ростом $x$ ошибка возрастает, причем не по линейному закону, а более быстро. Для шага $h_2=0.1$ ошибка меньше и возрастает медленнее, чем для шага $h_1=0.2$. 
	
	\subsection{Анализ зависимостей фактической ошибки и числа итераций от заданной точности.} 
	
	На графике зависимости фактической ошибки от заданной точности видим, что линия фактической ошибки во второй точке сеточной функции представляет из себя ломаную, периодически приближающуюся к биссектрисе первой координатной четверти, а затем отдаляющуюся (не более чем на порядок) от нее. Линия максимальной ошибки ведет себя аналогично линии для ошибки во второй точке, однако расположена на порядок выше биссектрисы координатной четверти, что объясняется тем, что при вычислении каждого следующего значения сеточной функции ошибка, оцениваемая по правилу Рунге, накапливается. Исходя из данного наблюдения, на данном графике и была построена линия для ошибки во второй точке сетки для демонстрации работы правила Рунге.
	
	На графике зависимости числа итераций от заданной точности видим, что линия числа итераций представляет из себя ломаную, близкую к прямой. На 2 порядка понижения $\epsilon$ соответствует увеличение числа итераций на 3.
	
	\subsection{Анализ зависимости фактической ошибки от возмущения начального условия.}
	
	На графике зависимости фактической ошибки от возмущения начального условия видим, что линия фактической ошибки почти в точности прямая $25.5\Delta y$ -- это означает, что ошибка линейно зависит от возмущения, причем для данной задачи Коши \eqref{mytask} с коэффициентом всего $25.5$. Например, в лабораторной работе №2 (3 семестр) о прямых методах решения СЛАУ матрица с числом обусловленности $<100$ считалась хорошо обусловленной.
	
	\subsection{Анализ зависимости фактической ошибки от величины шага.}
	
	На графике зависимости фактической ошибки от величины шага видим, что линия ошибки представляет из себя прямую для $h\leq10^{-2}$, а для больших $h$ отклоняется вогнуто от прямой. Это подтверждает гипотезу высказанную в пункте \ref{testexample} о причинах того, что правило Рунге дало погрешность меньше фактической. По графику были определены порядок метода -- 2 и константа -- $228.98$, т.е.
	\begin{equation}
		\delta_{\text{max}}\approx228.98h^2
	\end{equation}
	
	\section{Выводы.}
	
	\begin{itemize}
		\item Модифицированный метод Эйлера -- метод третьего порядка точности локально и второго -- глобально решения задачи Коши для ОДУ 1 порядка, разрешенного относительно производной.
		\item Правило Рунге позволяет неплохо апостериорно оценивать погрешность вычисления, однако при рекуррентном вычислении погрешность накапливается.
		\item Ошибка решения, полученного модифицированным методом Эйлера линейно зависит от возмущения начальных данных, притом в исследуемой задаче с относительно небольшим коэффициентом. 
	\end{itemize}
	
\end{document}